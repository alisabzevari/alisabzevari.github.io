<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Primitive ObsessionWhen modeling the entities in a software, we normally try to find the proper type of our domain models. For example, we might come up with the following model for User entity: 12345">
<meta name="keywords" content="typescript,DDD">
<meta property="og:type" content="article">
<meta property="og:title" content="Opaque types in Typescript">
<meta property="og:url" content="http:&#x2F;&#x2F;alisabzevari.github.io&#x2F;2020&#x2F;01&#x2F;21&#x2F;2020-01-21-typescript-opaque-types&#x2F;index.html">
<meta property="og:site_name" content="Ali Sabzevari">
<meta property="og:description" content="Primitive ObsessionWhen modeling the entities in a software, we normally try to find the proper type of our domain models. For example, we might come up with the following model for User entity: 12345">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-01-21T07:32:45.692Z">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Opaque types in Typescript</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/alisabzevari" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/05/17/2020-05-17-galaxy-earbuds-ubuntu/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/09/30/2017-10-3-you-might-not-need-state-management/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/" target="_blank" rel="noopener"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&text=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&is_video=false&description=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Opaque types in Typescript&body=Check out this article: http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&name=Opaque types in Typescript&description=" target="_blank" rel="noopener"><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Primitive-Obsession"><span class="toc-number">1.</span> <span class="toc-text">Primitive Obsession</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Opaque-types-to-the-rescue"><span class="toc-number">2.</span> <span class="toc-text">Opaque types to the rescue</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Opaque types in Typescript
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Ali Sabzevari</span>
      </span>
      
    <div class="postdate">
        <time datetime="2020-01-20T23:00:00.000Z" itemprop="datePublished">2020-01-21</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/DDD/" rel="tag">DDD</a>, <a class="tag-link" href="/tags/typescript/" rel="tag">typescript</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Primitive-Obsession"><a href="#Primitive-Obsession" class="headerlink" title="Primitive Obsession"></a>Primitive Obsession</h1><p>When modeling the entities in a software, we normally try to find the proper type of our domain models. For example, we might come up with the following model for <code>User</code> entity:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">  email: <span class="built_in">string</span>;</span><br><span class="line">  password: <span class="built_in">string</span>;</span><br><span class="line">  username: <span class="built_in">string</span>;</span><br><span class="line">  bio?: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">  createdAt: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This example, is similar to how we usually model <code>User</code> and as you can see, all the field types are primitives.</p>
<p>It is interesting to think why we use <code>string</code> for <code>email</code> but not for <code>createdAt</code>. Probably because <code>Date</code> was was already available in the language from day 0. That’s why we call them primitives. But why don’t we have <code>Email</code> or <code>Username</code> type? There a few benefits for defining types, even for such simple values:</p>
<ul>
<li>We can define proper domain models and assign its logic to the type. For example, validating an email address is a part of the <code>Email</code> domain model.</li>
<li>We can refactor the code using these types easier. For example, you would write email validation logic one time and changing it will affect everywhere. Additionally, the tooling can help you finding all the usages of email when you try to refactor.</li>
<li>Different types for different domain models prevent wrong assignments. For example, it prevents the programmer to wrongly assign a username value to <code>email</code> field.</li>
</ul>
<p>On the other hand, some of these domain models are extremely simple and defining a new type is cumbersome in most of the programming languages, but not in Typescript!</p>
<blockquote>
<p>Primitive Obsession is more than just an issue with simple types, but in this article, I would like to show you how to leverage Typescript compiler to solve one of the primitive obsession code smells. You can read more about primitive obsession <a href="https://refactoring.guru/smells/primitive-obsession" target="_blank" rel="noopener">here</a>.</p>
</blockquote>
<h1 id="Opaque-types-to-the-rescue"><a href="#Opaque-types-to-the-rescue" class="headerlink" title="Opaque types to the rescue"></a>Opaque types to the rescue</h1><p><a href="https://docs.scala-lang.org/sips/opaque-types.html" target="_blank" rel="noopener">Opaque Types</a> in Scala are an answer to this problem. One of the usecases is:</p>
<ul>
<li>Classes representing different entities with the same underlying type, such as <code>Id</code> and <code>Password</code> being defined in terms of <code>String</code> (<a href="https://docs.scala-lang.org/sips/opaque-types.html" target="_blank" rel="noopener">#</a>).</li>
</ul>
<p>And this is how it should be defined in Scala. Very simple!</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opaque <span class="class"><span class="keyword">type</span> <span class="title">Logarithm</span> </span>= <span class="type">Double</span></span><br></pre></td></tr></table></figure>

<p><a href="https://flow.org/en/docs/types/opaque-types/" target="_blank" rel="noopener">Flow</a> also supports opaque types out of the box and the syntax is very similar to Scala:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opaque type ID = string;</span><br></pre></td></tr></table></figure>

<p>Back to our example, we would like to change our <code>User</code> model to the following:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">  email: Email;</span><br><span class="line">  password: HashedPassword;</span><br><span class="line">  token?: Token;</span><br><span class="line">  username: Username;</span><br><span class="line">  bio?: Bio;</span><br><span class="line">  age: Age;</span><br><span class="line">  createdAt: CreatedAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So the following code should be a compile error:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user: User;</span><br><span class="line"></span><br><span class="line">user.password = <span class="string">"myUser"</span>; <span class="comment">// This should be a compile error</span></span><br></pre></td></tr></table></figure>

<p>In Typescript, it is possible to define a type that prevents wrong assignments, while still only holding a primitive at runtime. so we don’t break the serialization of the value:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">class</span> OpaqueTag&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> tag: S;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Opaque&lt;T, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = T &amp; OpaqueTag&lt;S&gt;;</span><br></pre></td></tr></table></figure>

<p>And the usage would be:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Email = Opaque&lt;<span class="built_in">string</span>, <span class="string">"Email"</span>&gt;;</span><br><span class="line"><span class="keyword">type</span> Username = Opaque&lt;<span class="built_in">string</span>, <span class="string">"Username"</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> email: Email = <span class="string">"alisabzevari@gmail.com"</span> <span class="keyword">as</span> Email;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> username: Username = email; <span class="comment">// This is a compile error</span></span><br></pre></td></tr></table></figure>

<p>By using <code>Opaque</code> helper, we get the following benefits:</p>
<ul>
<li>It is not possible to assign strings or other types to an opaque type variable. It will be a compile error.</li>
<li>String literals should be annotated with the correct type when assigning to an opaque type variable.</li>
<li>The variable holds just a string so there is no runtime overhead.</li>
<li>Serialization/Deserialization works out of the box.</li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/alisabzevari" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Primitive-Obsession"><span class="toc-number">1.</span> <span class="toc-text">Primitive Obsession</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Opaque-types-to-the-rescue"><span class="toc-number">2.</span> <span class="toc-text">Opaque types to the rescue</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/" target="_blank" rel="noopener"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&text=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&is_video=false&description=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Opaque types in Typescript&body=Check out this article: http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&title=Opaque types in Typescript" target="_blank" rel="noopener"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://alisabzevari.github.io/2020/01/21/2020-01-21-typescript-opaque-types/&name=Opaque types in Typescript&description=" target="_blank" rel="noopener"><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Ali Sabzevari
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/alisabzevari" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-107280259-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'alisabzevari';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


